openapi: 3.0.0
info:
  title: Task Management System API
  version: 1.0.0
  description: |
    A comprehensive REST API for managing tasks, projects, users, and comments.
    
    ## API Versioning
    All public API endpoints are versioned and available under `/api/v1`. The API supports optional version negotiation via the `Accept-Version` header. If no header is provided, the API defaults to version `v1`.
  contact:
    name: API Support

servers:
  - url: http://localhost:3000
    description: Development server

tags:
  - name: Health
    description: Health check endpoints
  - name: Authentication
    description: User authentication and registration endpoints
  - name: Users
    description: User management endpoints
  - name: Projects
    description: Project management endpoints
  - name: Tasks
    description: Task management endpoints
  - name: Comments
    description: Comment management endpoints

# Global security - applies to all endpoints unless overridden
security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Enter JWT token obtained from /api/v1/auth/login or /api/v1/auth/register

  parameters:
    AcceptVersion:
      name: Accept-Version
      in: header
      description: |
        Optional API version negotiation header. Supported values: `v1`. 
        If omitted, the API defaults to version `v1`. 
        If an unsupported version is requested, the API returns `400 Bad Request`.
      schema:
        type: string
        enum: [v1]
        default: v1
      required: false

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique user identifier
        email:
          type: string
          format: email
          description: User email address
        name:
          type: string
          description: User full name
        role:
          type: string
          enum: [owner, member]
          description: User role
        createdAt:
          type: string
          format: date-time
          description: User creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: User last update timestamp

    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique project identifier
        name:
          type: string
          description: Project name
        description:
          type: string
          nullable: true
          description: Project description
        ownerId:
          type: string
          format: uuid
          description: ID of the project owner
        owner:
          $ref: '#/components/schemas/User'
        members:
          type: array
          items:
            $ref: '#/components/schemas/ProjectMember'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ProjectMember:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        role:
          type: string
        user:
          $ref: '#/components/schemas/User'
        createdAt:
          type: string
          format: date-time

    Task:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique task identifier
        title:
          type: string
          description: Task title
        description:
          type: string
          nullable: true
          description: Task description
        status:
          type: string
          default: todo
          description: Task status
        priority:
          type: string
          default: medium
          description: Task priority
        projectId:
          type: string
          format: uuid
          description: ID of the project this task belongs to
        assignedToId:
          type: string
          format: uuid
          nullable: true
          description: ID of the user assigned to this task
        createdById:
          type: string
          format: uuid
          description: ID of the user who created this task
        assignedTo:
          $ref: '#/components/schemas/User'
          nullable: true
        createdBy:
          $ref: '#/components/schemas/User'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Comment:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique comment identifier
        content:
          type: string
          description: Comment content
        taskId:
          type: string
          format: uuid
          description: ID of the task this comment belongs to
        authorId:
          type: string
          format: uuid
          description: ID of the user who created this comment
        author:
          $ref: '#/components/schemas/User'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    RegisterRequest:
      type: object
      required:
        - email
        - password
        - name
      properties:
        email:
          type: string
          format: email
          description: User email address
        password:
          type: string
          minLength: 6
          description: User password (minimum 6 characters)
        name:
          type: string
          minLength: 1
          description: User full name
        # role:
        #   type: string
        #   enum: [owner, member]
        #   default: member
        #   description: User role (optional, defaults to member)

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User email address
        password:
          type: string
          description: User password

    AuthResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        token:
          type: string
          description: JWT authentication token

    CreateProjectRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 1
          description: Project name
        description:
          type: string
          description: Project description (optional)

    UpdateProjectRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          description: Project name
        description:
          type: string
          description: Project description

    AddMemberRequest:
      type: object
      required:
        - userId
        - role
      properties:
        userId:
          type: string
          format: uuid
          description: ID of the user to add as a member
        role:
          type: string
          minLength: 1
          description: Role of the member in the project

    CreateTaskRequest:
      type: object
      required:
        - title
      properties:
        title:
          type: string
          minLength: 1
          description: Task title
        description:
          type: string
          description: Task description (optional)
        status:
          type: string
          default: todo
          description: Task status
        priority:
          type: string
          default: medium
          description: Task priority
        assignedToId:
          type: string
          format: uuid
          nullable: true
          description: ID of the user to assign this task to (optional)

    UpdateTaskRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          description: Task title
        description:
          type: string
          description: Task description
        status:
          type: string
          description: Task status
        priority:
          type: string
          description: Task priority
        assignedToId:
          type: string
          format: uuid
          nullable: true
          description: ID of the user to assign this task to

    CreateCommentRequest:
      type: object
      required:
        - content
      properties:
        content:
          type: string
          minLength: 1
          description: Comment content

    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            message:
              type: string
              description: Error message
            code:
              type: string
              description: Error code

    PaginationResponse:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

paths:
  /health:
    get:
      summary: Health check endpoint
      description: Returns the health status of the API server
      tags: [Health]
      responses:
        '200':
          description: API is healthy and running
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                    description: Health status
                  timestamp:
                    type: string
                    format: date-time
                    description: Current server timestamp in ISO 8601 format
              example:
                status: ok
                timestamp: '2024-01-01T00:00:00.000Z'

  /api/v1/auth/register:
    post:
      summary: Register a new user
      tags: [Authentication]
      security: []  # Override global security - this endpoint is public
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User successfully registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Validation error or user already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/login:
    post:
      summary: Login with email and password
      tags: [Authentication]
      security: []  # Override global security - this endpoint is public
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/me:
    get:
      summary: Get current authenticated user information
      tags: [Authentication]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User information retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users:
    get:
      summary: Get all users
      tags: [Users]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of users per page
        - in: query
          name: search
          schema:
            type: string
          description: Search across user name and email (case-insensitive partial match)
        - in: query
          name: name
          schema:
            type: string
          description: Filter by exact name match
        - in: query
          name: email
          schema:
            type: string
          description: Filter by exact email match
        - in: query
          name: role
          schema:
            type: string
            enum: [owner, member]
          description: Filter by user role
        - in: query
          name: createdAfter
          schema:
            type: string
            format: date-time
          description: Filter users created after this ISO 8601 date
        - in: query
          name: createdBefore
          schema:
            type: string
            format: date-time
          description: Filter users created before this ISO 8601 date
        - in: query
          name: updatedAfter
          schema:
            type: string
            format: date-time
          description: Filter users updated after this ISO 8601 date
        - in: query
          name: updatedBefore
          schema:
            type: string
            format: date-time
          description: Filter users updated before this ISO 8601 date
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [name, email, createdAt, updatedAt]
            default: createdAt
          description: Field to sort by
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort direction
        - in: query
          name: fields
          schema:
            type: string
          description: Comma-separated field names to include in response (id, name, email, role, createdAt, updatedAt). 'id' is always included.
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        name:
                          type: string
                        email:
                          type: string
                        role:
                          type: string
                          enum: [owner, member]
                        createdAt:
                          type: string
                          format: date-time
                        updatedAt:
                          type: string
                          format: date-time
                  pagination:
                    $ref: '#/components/schemas/PaginationResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/{id}:
    get:
      summary: Get user by ID
      tags: [Users]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/projects:
    post:
      summary: Create a new project
      tags: [Projects]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        '201':
          description: Project created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  project:
                    $ref: '#/components/schemas/Project'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Get all projects for the authenticated user
      tags: [Projects]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: query
          name: include
          schema:
            type: string
          description: Comma-separated list of relations to include (e.g., "owner,members,tasks")
          example: owner,members,tasks
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of items per page
        - in: query
          name: search
          schema:
            type: string
          description: Search term for case-insensitive partial match on project name and description
          example: my project
        - in: query
          name: name
          schema:
            type: string
          description: Filter by exact project name
          example: My Project
        - in: query
          name: ownerId
          schema:
            type: string
            format: uuid
          description: Filter by owner ID
        - in: query
          name: createdAfter
          schema:
            type: string
            format: date-time
          description: Filter projects created after this ISO 8601 date
          example: '2024-01-01T00:00:00Z'
        - in: query
          name: createdBefore
          schema:
            type: string
            format: date-time
          description: Filter projects created before this ISO 8601 date
          example: '2024-12-31T23:59:59Z'
        - in: query
          name: updatedAfter
          schema:
            type: string
            format: date-time
          description: Filter projects updated after this ISO 8601 date
          example: '2024-01-01T00:00:00Z'
        - in: query
          name: updatedBefore
          schema:
            type: string
            format: date-time
          description: Filter projects updated before this ISO 8601 date
          example: '2024-12-31T23:59:59Z'
        - in: query
          name: myRole
          schema:
            type: string
            enum: [owner, member]
          description: Filter by authenticated user's role in project
          example: owner
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [name, createdAt, updatedAt]
            default: createdAt
          description: Field to sort by
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort direction
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Projects retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  projects:
                    type: array
                    items:
                      $ref: '#/components/schemas/Project'
                  pagination:
                    $ref: '#/components/schemas/PaginationResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/projects/{id}:
    get:
      summary: Get project by ID
      tags: [Projects]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Project ID
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Project retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  project:
                    $ref: '#/components/schemas/Project'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Update a project
      tags: [Projects]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Project ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectRequest'
      responses:
        '200':
          description: Project updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  project:
                    $ref: '#/components/schemas/Project'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Only project owner can update
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete a project
      tags: [Projects]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Project ID
      responses:
        '204':
          description: Project deleted successfully
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Only project owner can delete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/projects/{id}/members:
    post:
      summary: Add a member to a project
      tags: [Projects]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Project ID
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddMemberRequest'
      responses:
        '201':
          description: Member added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  member:
                    $ref: '#/components/schemas/ProjectMember'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Only project owner can add members
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Project or user not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/projects/{id}/members/{userId}:
    delete:
      summary: Remove a member from a project
      tags: [Projects]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Project ID
        - in: path
          name: userId
          required: true
          schema:
            type: string
            format: uuid
          description: User ID to remove
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Member removed successfully
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Only project owner can remove members
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Project or member not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/projects/{projectId}/tasks:
    post:
      summary: Create a new task in a project
      tags: [Tasks]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
          description: Project ID
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTaskRequest'
      responses:
        '201':
          description: Task created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  task:
                    $ref: '#/components/schemas/Task'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied to project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Get all tasks for a project
      tags: [Tasks]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: projectId
          required: true
          schema:
            type: string
            format: uuid
          description: Project ID
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of items per page
        - in: query
          name: search
          schema:
            type: string
          description: Search term for case-insensitive partial match on task title and description
          example: bug fix
        - in: query
          name: title
          schema:
            type: string
          description: Filter by exact task title
          example: Fix login bug
        - in: query
          name: status
          schema:
            type: string
          description: Filter by task status (e.g., "todo", "in-progress", "done")
          example: in-progress
        - in: query
          name: priority
          schema:
            type: string
          description: Filter by task priority (e.g., "low", "medium", "high")
          example: high
        - in: query
          name: assignedToId
          schema:
            type: string
            format: uuid
          description: Filter by assigned user ID
        - in: query
          name: createdById
          schema:
            type: string
            format: uuid
          description: Filter by creator user ID
        - in: query
          name: unassigned
          schema:
            type: string
            enum: [true, false]
          description: Filter for unassigned tasks (true) or assigned tasks (false)
          example: 'true'
        - in: query
          name: createdAfter
          schema:
            type: string
            format: date-time
          description: Filter tasks created after this ISO 8601 date
          example: '2024-01-01T00:00:00Z'
        - in: query
          name: createdBefore
          schema:
            type: string
            format: date-time
          description: Filter tasks created before this ISO 8601 date
          example: '2024-12-31T23:59:59Z'
        - in: query
          name: updatedAfter
          schema:
            type: string
            format: date-time
          description: Filter tasks updated after this ISO 8601 date
          example: '2024-01-01T00:00:00Z'
        - in: query
          name: updatedBefore
          schema:
            type: string
            format: date-time
          description: Filter tasks updated before this ISO 8601 date
          example: '2024-12-31T23:59:59Z'
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [title, status, priority, createdAt, updatedAt]
            default: createdAt
          description: Field to sort by
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort direction
        - in: query
          name: include
          schema:
            type: string
          description: 'Comma-separated list of relations to include (valid values: comments, project, assignedTo, createdBy). Default includes: project, assignedTo, createdBy'
          example: comments,project,assignedTo,createdBy
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Tasks retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  tasks:
                    type: array
                    items:
                      $ref: '#/components/schemas/Task'
                  pagination:
                    $ref: '#/components/schemas/PaginationResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied to project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/tasks/{id}:
    get:
      summary: Get task by ID
      tags: [Tasks]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Task ID
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Task retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  task:
                    $ref: '#/components/schemas/Task'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied to task
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Task not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Update a task
      tags: [Tasks]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Task ID
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTaskRequest'
      responses:
        '200':
          description: Task updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  task:
                    $ref: '#/components/schemas/Task'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied to task
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Task not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete a task
      tags: [Tasks]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Task ID
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Task deleted successfully
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied to task
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Task not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/tasks/{taskId}/comments:
    post:
      summary: Create a new comment on a task
      tags: [Comments]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: taskId
          required: true
          schema:
            type: string
            format: uuid
          description: Task ID
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCommentRequest'
      responses:
        '201':
          description: Comment created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    $ref: '#/components/schemas/Comment'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied to task
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Task not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Get all comments for a task
      tags: [Comments]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: taskId
          required: true
          schema:
            type: string
            format: uuid
          description: Task ID
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of comments per page
        - in: query
          name: search
          schema:
            type: string
          description: Search term to filter comments by content (case-insensitive partial match)
        - in: query
          name: authorId
          schema:
            type: string
            format: uuid
          description: Filter comments by author user ID
        - in: query
          name: myComments
          schema:
            type: string
            enum: [true, false]
          description: Filter comments by current authenticated user (true = only my comments, false = exclude my comments). Takes precedence over authorId if both are provided.
        - in: query
          name: createdAfter
          schema:
            type: string
            format: date-time
          description: Filter comments created after this ISO 8601 date
        - in: query
          name: createdBefore
          schema:
            type: string
            format: date-time
          description: Filter comments created before this ISO 8601 date
        - in: query
          name: updatedAfter
          schema:
            type: string
            format: date-time
          description: Filter comments updated after this ISO 8601 date
        - in: query
          name: updatedBefore
          schema:
            type: string
            format: date-time
          description: Filter comments updated before this ISO 8601 date
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [createdAt, updatedAt]
            default: createdAt
          description: Field to sort by (createdAt or updatedAt). Defaults to createdAt if invalid value provided.
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: asc
          description: Sort direction (asc or desc). Defaults to asc if invalid value provided.
        - in: query
          name: include
          schema:
            type: string
          description: 'Comma-separated list of relations to include (valid values: "task", "author"). By default, "author" is included. Use this parameter to selectively include/exclude relations (e.g., "task,author" or "task").'
      responses:
        '200':
          description: Comments retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  comments:
                    type: array
                    items:
                      $ref: '#/components/schemas/Comment'
                  pagination:
                    $ref: '#/components/schemas/PaginationResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied to task
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Task not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/comments/{id}:
    delete:
      summary: Delete a comment
      tags: [Comments]
      parameters:
        - $ref: '#/components/parameters/AcceptVersion'
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Comment ID
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Comment deleted successfully
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied - only comment author can delete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Comment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

